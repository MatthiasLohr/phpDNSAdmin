<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.8.2.min.js"></script>
		<script type="text/javascript" src="js/jquery.cookie.js"></script>
		<script type="text/javascript" src="js/jquery.jstree.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				$("#zonetree").jstree({
					core: {
						animation: 10
					},
					plugins: ['json_data','types','themes'],
					json_data: {
						ajax: {
							url: function(node) {
								this.contextNode = node;
								if (node == -1) return "api/servers";
								tagid = node.attr('id');
								if (tagid.substr(0,7) == "server-") {
									return "api/servers/"+tagid.substr(7)+"/zones";
								}

							},
							success: function(data) {
								if (this.contextNode == -1) {
									servers = [];
									for (sysname in data) {
										servers.push({
											data: data[sysname]['name'],
											state: "closed",
											attr: {
												id: "server-"+sysname
											}
										});
									}
									return servers;
								}
								else {
									tagid = this.contextNode.attr('id');
									if (tagid.substr(0,7) == "server-") {
										zones = [];
										$(data).each(function(index,zone) {
											zones.push({data: zone.name});
										});
										return zones;
									}
								}
								return {};
							}
						}
					},
					themes: {
						url: 'js/jstree-themes/default/style.css'
					},
					types: {
						server: {
							valid_children: ['ezone','izone'],
							open_node: function(arg1) {
								alert(arg1);
							}
						},
						ezone: {
							valid_children: ['ezone','izone']
						},
						izone: {
							valid_children: ['ezone','izone']
						}
					}
				});
			});
		</script>
  </head>
  <body>
    <div id="zonetree">
			
		</div>
		<input type="submit" onclick="addServer('a','b');" value="Add server" />
  </body>
</html>
